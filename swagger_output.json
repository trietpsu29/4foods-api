{
  "swagger": "2.0",
  "info": {
    "title": "4Foods API",
    "description": "API documentation for 4Foods Android app",
    "version": "1.0.0"
  },
  "host": "api.4foods.app",
  "basePath": "/",
  "schemes": ["https"],
  "consumes": ["application/json"],
  "produces": ["application/json"],
  "securityDefinitions": {
    "Bearer": {
      "type": "apiKey",
      "name": "Authorization",
      "in": "header",
      "description": "Enter your bearer token in the format **Bearer <token>**"
    }
  },
  "paths": {
    "/auth/check-email": {
      "get": {
        "tags": ["Auth"],
        "summary": "Check if email already exists",
        "parameters": [
          {
            "name": "email",
            "in": "query",
            "required": true,
            "type": "string",
            "example": "user@example.com"
          }
        ],
        "responses": {
          "200": {
            "description": "Email check result",
            "examples": { "application/json": { "exists": false } }
          },
          "400": {
            "description": "Missing email",
            "examples": { "application/json": { "error": "Missing email" } }
          }
        }
      }
    },

    "/auth/register": {
      "post": {
        "tags": ["Auth"],
        "summary": "Register new user",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "properties": {
                "name": { "type": "string", "example": "Posu" },
                "email": { "type": "string", "example": "posu@example.com" },
                "password": { "type": "string", "example": "mypassword123" },
                "role": { "type": "string", "example": "user" }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "User registered successfully",
            "examples": {
              "application/json": {
                "message": "Account created successfully",
                "user": {
                  "id": "672f8d42b9a12345c1234567",
                  "email": "posu@example.com"
                }
              }
            }
          },
          "400": { "description": "Validation error" }
        }
      }
    },

    "/auth/login": {
      "post": {
        "tags": ["Auth"],
        "summary": "Login user",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "properties": {
                "email": { "type": "string", "example": "posu@example.com" },
                "password": { "type": "string", "example": "mypassword123" }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Login success",
            "examples": {
              "application/json": {
                "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                "user": {
                  "id": "672f8d42b9a12345c1234567",
                  "name": "Posu",
                  "email": "posu@example.com",
                  "role": "user",
                  "isSeller": false
                }
              }
            }
          },
          "401": { "description": "Invalid credentials" }
        }
      }
    },

    "/auth/google": {
      "post": {
        "tags": ["Auth"],
        "summary": "Login or register via Google OAuth",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "properties": {
                "credential": {
                  "type": "string",
                  "example": "ya29.a0AfH6SM..."
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Google login success",
            "examples": {
              "application/json": {
                "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                "user": {
                  "id": "672f8d42b9a12345c1234567",
                  "name": "Posu",
                  "email": "posu@example.com",
                  "isSeller": false
                }
              }
            }
          }
        }
      }
    },

    "/auth/facebook": {
      "post": {
        "tags": ["Auth"],
        "summary": "Login or register via Facebook OAuth",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "properties": {
                "accessToken": {
                  "type": "string",
                  "example": "EAAGm0PX4ZCpsBAKZCZ..."
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Facebook login success",
            "examples": {
              "application/json": {
                "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
                "user": {
                  "id": "672f8d42b9a12345c1234567",
                  "name": "Posu",
                  "email": "posu@example.com",
                  "isSeller": false
                }
              }
            }
          },
          "400": {
            "description": "Missing access token or invalid Facebook response"
          }
        }
      }
    },

    "/auth/forgot-password": {
      "post": {
        "tags": ["Auth"],
        "summary": "Request OTP to reset password",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "properties": {
                "email": { "type": "string", "example": "posu@example.com" }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OTP sent successfully",
            "examples": {
              "application/json": { "message": "OTP sent to email" }
            }
          },
          "404": { "description": "User not found" }
        }
      }
    },

    "/auth/verify-otp": {
      "post": {
        "tags": ["Auth"],
        "summary": "Verify OTP code from email",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "properties": {
                "email": { "type": "string", "example": "posu@example.com" },
                "code": { "type": "string", "example": "54321" }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OTP verified successfully",
            "examples": {
              "application/json": { "message": "OTP verified successfully" }
            }
          },
          "400": { "description": "Invalid or expired OTP" }
        }
      }
    },

    "/auth/reset-password": {
      "post": {
        "tags": ["Auth"],
        "summary": "Reset password using verified OTP",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "properties": {
                "email": { "type": "string", "example": "posu@example.com" },
                "newPassword": { "type": "string", "example": "newpassword123" }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Password updated successfully",
            "examples": {
              "application/json": { "message": "Password updated successfully" }
            }
          },
          "400": { "description": "OTP expired or invalid" }
        }
      }
    },

    "/products": {
      "post": {
        "tags": ["Product"],
        "summary": "Create product (seller or admin)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "required": ["name", "price", "categoryId", "imageUrl"],
              "properties": {
                "name": { "type": "string" },
                "price": { "type": "number" },
                "description": { "type": "string" },
                "categoryId": { "type": "string" },
                "imageUrl": { "type": "string" },
                "discountPercent": { "type": "number" },
                "prepTime": { "type": "number" },
                "stock": { "type": "number" },
                "shopId": {
                  "type": "string",
                  "description": "Admin only (override seller shop)"
                }
              }
            },
            "example": {
              "name": "Trà Sữa Truyền Thống",
              "price": 30000,
              "description": "Vị truyền thống thơm béo",
              "categoryId": "671acb0298f2c700f9e2c5a9",
              "imageUrl": "https://cdn.4foods.app/p/tra-sua.jpg",
              "discountPercent": 10,
              "prepTime": 5,
              "stock": 120
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Created",
            "examples": {
              "application/json": {
                "message": "Product created & pending approval",
                "product": {
                  "_id": "67310df7d9c6a8f016ca9123",
                  "name": "Trà Sữa Truyền Thống",
                  "price": 30000,
                  "status": "pending",
                  "category": "671acb0298f2c700f9e2c5a9",
                  "discountPercent": 10,
                  "stock": 120,
                  "createdAt": "2025-11-20T08:10:00.000Z"
                }
              }
            }
          },
          "400": {
            "description": "Validation error",
            "examples": {
              "application/json": { "error": "Missing required fields" }
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": {
              "application/json": {
                "error": "Only sellers or admins can add products"
              }
            }
          }
        }
      },
      "get": {
        "tags": ["Product"],
        "summary": "Search & list products (normalized, filter, sort, paginate)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "shopId",
            "in": "query",
            "type": "string",
            "required": false,
            "example": "671a6cb29e2c5a9d"
          },
          {
            "name": "categoryId",
            "in": "query",
            "type": "string",
            "required": false,
            "example": "671acb0298f2c700f9e2c5a9"
          },
          {
            "name": "keyword",
            "in": "query",
            "type": "string",
            "required": false,
            "example": "tra sua truyen thong"
          },
          {
            "name": "sort",
            "in": "query",
            "type": "string",
            "required": false,
            "enum": ["rate", "price", "recent"],
            "example": "rate"
          },
          {
            "name": "page",
            "in": "query",
            "type": "integer",
            "required": false,
            "example": 1
          },
          {
            "name": "limit",
            "in": "query",
            "type": "integer",
            "required": false,
            "example": 10
          }
        ],
        "responses": {
          "200": {
            "description": "Paginated list",
            "examples": {
              "application/json": {
                "total": 57,
                "page": 1,
                "totalPages": 6,
                "products": [
                  {
                    "_id": "67310df7d9c6a8f016ca9123",
                    "name": "Trà Sữa Truyền Thống",
                    "imageUrl": "https://cdn.4foods.app/p/tra-sua.jpg",
                    "price": 30000,
                    "stock": 120,
                    "rating": 4.7,
                    "discountPercent": 10,
                    "description": "Vị truyền thống thơm béo",
                    "createdAt": "2025-11-20T08:10:00.000Z",
                    "category": "Trà sữa",
                    "shop": "Tiệm Trà Sữa Posu",
                    "shopAddress": "123 Đường Hàn Thuyên"
                  }
                ]
              }
            }
          },
          "500": {
            "description": "Server error",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      }
    },

    "/products/{id}": {
      "get": {
        "tags": ["Product"],
        "summary": "Get product details (admin only)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "67310df7d9c6a8f016ca9123"
          }
        ],
        "responses": {
          "200": {
            "description": "Details",
            "examples": {
              "application/json": {
                "_id": "67310df7d9c6a8f016ca9123",
                "name": "Trà Sữa Truyền Thống",
                "price": 30000,
                "status": "pending",
                "category": { "name": "Trà sữa" },
                "shopId": {
                  "name": "Tiệm Trà Sữa Posu",
                  "address": "123 Đường Hàn Thuyên",
                  "isOpen": true
                },
                "sellerId": {
                  "name": "Posu Seller",
                  "email": "seller@4foods.app"
                },
                "comments": []
              }
            }
          },
          "404": {
            "description": "Not found",
            "examples": { "application/json": { "error": "Product not found" } }
          },
          "500": { "description": "Server error" }
        }
      },
      "put": {
        "tags": ["Product"],
        "summary": "Update product (seller own or admin)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "67310df7d9c6a8f016ca9123"
          },
          {
            "in": "body",
            "name": "body",
            "schema": { "type": "object" },
            "example": {
              "name": "Trà Sữa Truyền Thống (Mới)",
              "price": 32000,
              "discountPercent": 5
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Updated",
            "examples": {
              "application/json": {
                "_id": "67310df7d9c6a8f016ca9123",
                "status": "pending"
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": {
              "application/json": {
                "error": "You can only update your own products"
              }
            }
          },
          "400": {
            "description": "Invalid",
            "examples": {
              "application/json": {
                "error": "Pending product cannot be edited"
              }
            }
          },
          "404": { "description": "Not found" }
        }
      },
      "delete": {
        "tags": ["Product"],
        "summary": "Delete product (seller own or admin)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "67310df7d9c6a8f016ca9123"
          }
        ],
        "responses": {
          "200": {
            "description": "Deleted",
            "examples": {
              "application/json": { "message": "Product deleted successfully" }
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": {
              "application/json": {
                "error": "You can only delete your own product"
              }
            }
          },
          "404": { "description": "Not found" }
        }
      }
    },

    "/products/{id}/approve": {
      "put": {
        "tags": ["Product"],
        "summary": "Admin approve/reject product",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "67310df7d9c6a8f016ca9123"
          },
          {
            "in": "body",
            "name": "body",
            "schema": {
              "type": "object",
              "required": ["status"],
              "properties": {
                "status": {
                  "type": "string",
                  "enum": ["displayed", "rejected", "pending"]
                },
                "reason": { "type": "string" }
              }
            },
            "example": { "status": "displayed" }
          }
        ],
        "responses": {
          "200": {
            "description": "Status updated",
            "examples": {
              "application/json": {
                "message": "Product status updated to displayed"
              }
            }
          },
          "400": {
            "description": "Invalid status",
            "examples": { "application/json": { "error": "Invalid status" } }
          },
          "403": {
            "description": "Forbidden",
            "examples": { "application/json": { "error": "Admin only" } }
          },
          "404": { "description": "Not found" }
        }
      }
    },

    "/products/{id}/toggle": {
      "put": {
        "tags": ["Product"],
        "summary": "Seller toggle displayed/hidden",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "67310df7d9c6a8f016ca9123"
          }
        ],
        "responses": {
          "200": {
            "description": "Toggled",
            "examples": {
              "application/json": { "message": "Product is now hidden" }
            }
          },
          "400": {
            "description": "Invalid",
            "examples": {
              "application/json": {
                "error": "Only approved products can be toggled"
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": { "application/json": { "error": "Forbidden" } }
          },
          "404": { "description": "Not found" }
        }
      }
    },

    "/products/{id}/comment": {
      "post": {
        "tags": ["Product"],
        "summary": "Add comment",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "67310df7d9c6a8f016ca9123"
          },
          {
            "in": "body",
            "name": "body",
            "schema": {
              "type": "object",
              "required": ["content"],
              "properties": {
                "content": { "type": "string" },
                "rating": { "type": "number" },
                "images": { "type": "array", "items": { "type": "string" } }
              }
            },
            "example": {
              "content": "Ngon và mát!",
              "rating": 5,
              "images": ["https://cdn.4foods.app/comments/c1.jpg"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Added",
            "examples": {
              "application/json": {
                "message": "Comment added",
                "comment": { "content": "Ngon và mát!", "rating": 5 }
              }
            }
          },
          "404": {
            "description": "Not found",
            "examples": { "application/json": { "error": "Product not found" } }
          },
          "400": {
            "description": "Validation",
            "examples": {
              "application/json": { "error": "Comment content required" }
            }
          }
        }
      }
    },

    "/products/{id}/comments": {
      "get": {
        "tags": ["Product"],
        "summary": "List comments",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "67310df7d9c6a8f016ca9123"
          }
        ],
        "responses": {
          "200": {
            "description": "Comments",
            "examples": {
              "application/json": [
                {
                  "user": { "name": "Minh Tran", "avatar": "/avatars/1.png" },
                  "content": "Rất ngon!",
                  "rating": 5,
                  "images": []
                }
              ]
            }
          },
          "404": {
            "description": "Not found",
            "examples": { "application/json": { "error": "Product not found" } }
          }
        }
      }
    },

    "/admin/stats": {
      "get": {
        "tags": ["Admin"],
        "summary": "Platform statistics",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "range",
            "in": "query",
            "type": "string",
            "enum": ["daily", "weekly", "monthly"],
            "required": false,
            "example": "weekly"
          }
        ],
        "responses": {
          "200": {
            "description": "Stats",
            "examples": {
              "application/json": {
                "range": "weekly",
                "revenue": 1543000,
                "previousRevenue": 1320000,
                "revenueChange": 16.94,
                "orderCount": 312,
                "previousOrderCount": 280,
                "orderChange": 11.43,
                "userCount": 4872,
                "productCount": 1465
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": { "application/json": { "error": "Access denied" } }
          },
          "500": {
            "description": "Server error",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      }
    },

    "/user": {
      "get": {
        "tags": ["User"],
        "summary": "List all users (Admin only)",
        "description": "Admin fetches all users.",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "List of users",
            "examples": {
              "application/json": [
                {
                  "_id": "6754b6f82e9c2a4f77f1b5d1",
                  "name": "Nguyễn Văn A",
                  "email": "a@example.com",
                  "role": "user",
                  "isSeller": false,
                  "coin": 0
                }
              ]
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": { "application/json": { "error": "Admin access only" } }
          },
          "500": {
            "description": "Server error",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      }
    },
    "/user/{id}": {
      "get": {
        "tags": ["User"],
        "summary": "Get user by ID (Admin only)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "6754b6f82e9c2a4f77f1b5d1"
          }
        ],
        "responses": {
          "200": {
            "description": "User detail",
            "examples": {
              "application/json": {
                "_id": "6754b6f82e9c2a4f77f1b5d1",
                "name": "Nguyễn Văn A",
                "email": "a@example.com",
                "role": "user",
                "isSeller": false,
                "phone": "0987654321",
                "addresses": [],
                "coin": 0,
                "createdAt": "2025-11-20T08:10:00.000Z"
              }
            }
          },
          "404": {
            "description": "Not found",
            "examples": { "application/json": { "error": "User not found" } }
          },
          "403": {
            "description": "Forbidden",
            "examples": { "application/json": { "error": "Admin access only" } }
          }
        }
      },
      "put": {
        "tags": ["User"],
        "summary": "Update user by ID (Admin only)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "6754b6f82e9c2a4f77f1b5d1"
          },
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "name": { "type": "string" },
                "phone": { "type": "string" },
                "role": { "type": "string", "enum": ["user", "admin"] },
                "isSeller": { "type": "boolean" },
                "coin": { "type": "number" }
              }
            },
            "example": {
              "name": "Nguyễn Văn A (Cập nhật)",
              "phone": "0912345678",
              "role": "user",
              "isSeller": true,
              "coin": 120
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Updated",
            "examples": {
              "application/json": {
                "message": "User updated",
                "user": {
                  "_id": "6754b6f82e9c2a4f77f1b5d1",
                  "name": "Nguyễn Văn A (Cập nhật)",
                  "phone": "0912345678",
                  "role": "user",
                  "isSeller": true,
                  "coin": 120
                }
              }
            }
          },
          "404": {
            "description": "Not found",
            "examples": { "application/json": { "error": "User not found" } }
          },
          "403": {
            "description": "Forbidden",
            "examples": { "application/json": { "error": "Admin access only" } }
          },
          "500": {
            "description": "Server error",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      },
      "delete": {
        "tags": ["User"],
        "summary": "Delete user by ID (Admin only)",
        "description": "Requires a reason in body. Sends email before deletion.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "6754b6f82e9c2a4f77f1b5d1"
          },
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "required": ["reason"],
              "properties": { "reason": { "type": "string" } }
            },
            "example": { "reason": "Vi phạm điều khoản sử dụng" }
          }
        ],
        "responses": {
          "200": {
            "description": "Deleted",
            "examples": {
              "application/json": { "message": "User deleted and email sent" }
            }
          },
          "400": {
            "description": "Missing reason",
            "examples": {
              "application/json": {
                "error": "Reason is required to delete account"
              }
            }
          },
          "404": {
            "description": "Not found",
            "examples": { "application/json": { "error": "User not found" } }
          },
          "403": {
            "description": "Forbidden",
            "examples": { "application/json": { "error": "Admin access only" } }
          },
          "500": {
            "description": "Server error",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      }
    },
    "/user/me": {
      "get": {
        "tags": ["User"],
        "summary": "Get current user",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "User",
            "examples": {
              "application/json": {
                "id": "6754b6f82e9c2a4f77f1b5d1",
                "name": "Nguyễn Văn A",
                "email": "a@example.com",
                "role": "user",
                "isSeller": false,
                "addresses": []
              }
            }
          }
        }
      },
      "put": {
        "tags": ["User"],
        "summary": "Update current user",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "schema": { "type": "object" },
            "example": {
              "name": "Nguyễn Văn A",
              "phone": "0987654321",
              "dob": "2001-03-15",
              "permanentAddress": "Hà Nội"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Updated",
            "examples": {
              "application/json": {
                "name": "Nguyễn Văn A",
                "phone": "0987654321"
              }
            }
          }
        }
      }
    },

    "/user/me/change-password": {
      "put": {
        "tags": ["User"],
        "summary": "Change password",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "schema": {
              "type": "object",
              "required": ["oldPassword", "newPassword"]
            },
            "example": { "oldPassword": "123456", "newPassword": "Abc@123456" }
          }
        ],
        "responses": {
          "200": {
            "description": "Changed",
            "examples": {
              "application/json": { "message": "Password changed" }
            }
          },
          "400": {
            "description": "Error",
            "examples": {
              "application/json": { "error": "Old password incorrect" }
            }
          }
        }
      }
    },

    "/user/me/addresses": {
      "post": {
        "tags": ["User"],
        "summary": "Add address",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "schema": {
              "type": "object",
              "required": [
                "name",
                "phone",
                "province",
                "district",
                "ward",
                "detail"
              ]
            },
            "example": {
              "label": "home",
              "name": "Nguyễn Văn A",
              "phone": "0912345678",
              "province": "Hà Nội",
              "district": "Cầu Giấy",
              "ward": "Dịch Vọng",
              "detail": "Số 10, Ngõ 20",
              "isPrimary": true
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Added",
            "examples": {
              "application/json": [
                { "name": "Nguyễn Văn A", "isPrimary": true }
              ]
            }
          },
          "400": {
            "description": "Missing",
            "examples": {
              "application/json": { "error": "Missing required address fields" }
            }
          }
        }
      }
    },

    "/user/me/addresses/{idx}": {
      "put": {
        "tags": ["User"],
        "summary": "Update address by index",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "idx",
            "in": "path",
            "required": true,
            "type": "integer",
            "example": 0
          },
          {
            "in": "body",
            "name": "body",
            "schema": { "type": "object" },
            "example": { "note": "Giao sáng", "isPrimary": true }
          }
        ],
        "responses": {
          "200": {
            "description": "Updated",
            "examples": {
              "application/json": [
                { "name": "Nguyễn Văn A", "isPrimary": true }
              ]
            }
          },
          "404": {
            "description": "Not found",
            "examples": { "application/json": { "error": "Address not found" } }
          }
        }
      },
      "delete": {
        "tags": ["User"],
        "summary": "Delete address by index",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "idx",
            "in": "path",
            "required": true,
            "type": "integer",
            "example": 0
          }
        ],
        "responses": {
          "200": {
            "description": "Deleted",
            "examples": { "application/json": [] }
          },
          "404": {
            "description": "Not found",
            "examples": { "application/json": { "error": "Address not found" } }
          }
        }
      }
    },

    "/user/me/delete-request": {
      "post": {
        "tags": ["User"],
        "summary": "Request account deletion",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "schema": { "type": "object", "required": ["reason"] },
            "example": { "reason": "Không muốn sử dụng nữa" }
          }
        ],
        "responses": {
          "200": {
            "description": "Requested",
            "examples": {
              "application/json": {
                "message": "Yêu cầu xóa tài khoản đã được gửi đến admin"
              }
            }
          }
        }
      }
    },

    "/user/follow/{shopId}": {
      "post": {
        "tags": ["User"],
        "summary": "Follow shop",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "shopId",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "6733f0d024f23c6f9c28a77d"
          }
        ],
        "responses": {
          "200": {
            "description": "Followed",
            "examples": {
              "application/json": { "message": "Shop followed successfully" }
            }
          },
          "404": {
            "description": "Not found",
            "examples": {
              "application/json": { "error": "Shop not found or unavailable" }
            }
          }
        }
      }
    },

    "/user/unfollow/{shopId}": {
      "delete": {
        "tags": ["User"],
        "summary": "Unfollow shop",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "shopId",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "6733f0d024f23c6f9c28a77d"
          }
        ],
        "responses": {
          "200": {
            "description": "Unfollowed",
            "examples": {
              "application/json": { "message": "Unfollowed shop successfully" }
            }
          },
          "404": {
            "description": "Not found",
            "examples": { "application/json": { "error": "Shop not found" } }
          }
        }
      }
    },

    "/user/me/followed-shops": {
      "get": {
        "tags": ["User"],
        "summary": "List followed shops",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "List",
            "examples": {
              "application/json": [
                {
                  "_id": "6733f0d024f23c6f9c28a77d",
                  "name": "Tiệm Trà Sữa Posu",
                  "isOpen": true
                }
              ]
            }
          }
        }
      }
    },

    "/orders": {
      "post": {
        "tags": ["Order"],
        "summary": "Place order (COD or Momo)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "schema": {
              "type": "object",
              "required": ["items", "addressId", "paymentMethod"],
              "properties": {
                "items": {
                  "type": "array",
                  "items": {
                    "type": "object",
                    "required": ["product", "quantity"],
                    "properties": {
                      "product": { "type": "string" },
                      "quantity": { "type": "integer" }
                    }
                  }
                },
                "addressId": { "type": "integer" },
                "paymentMethod": { "type": "string", "enum": ["cod", "momo"] },
                "noteForShop": { "type": "string" },
                "noteForShipper": { "type": "string" },
                "voucherId": { "type": "string" }
              }
            },
            "example": {
              "items": [
                { "product": "6730b2ac1b7c5d84e843a932", "quantity": 2 },
                { "product": "6730b2ac1b7c5d84e843a945", "quantity": 1 }
              ],
              "addressId": 0,
              "paymentMethod": "momo",
              "noteForShop": "Ít đá",
              "noteForShipper": "Gọi trước khi đến",
              "voucherId": "6730a5c8ee95d2e879cd7a94"
            }
          }
        ],
        "responses": {
          "201": {
            "description": "COD order created",
            "examples": {
              "application/json": {
                "message": "Order placed successfully",
                "order": {
                  "_id": "6730b6f2afc9e7f016ca927d",
                  "user": "672faec86dc123a9b47d51af",
                  "items": [
                    {
                      "product": "6730b2ac1b7c5d84e843a932",
                      "name": "Trà Sữa Truyền Thống",
                      "price": 30000,
                      "quantity": 2
                    }
                  ],
                  "subtotal": 60000,
                  "discount": 5000,
                  "deliveryFee": 15000,
                  "total": 70000,
                  "paymentMethod": "cod",
                  "status": "processing"
                }
              }
            }
          },
          "200": {
            "description": "Momo session created",
            "examples": {
              "application/json": {
                "message": "Redirect to MoMo",
                "payUrl": "https://test-payment.momo.vn/pay/abcdef"
              }
            }
          },
          "400": {
            "description": "Validation",
            "examples": {
              "application/json": {
                "error": "Product Trà Sữa Truyền Thống out of stock"
              }
            }
          }
        }
      }
    },

    "/orders/momo/callback": {
      "post": {
        "tags": ["Order"],
        "summary": "MoMo IPN callback",
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "schema": { "type": "object" },
            "example": {
              "partnerCode": "MOMO",
              "accessKey": "F8BBA842ECF85",
              "orderId": "MOMO1732000000000",
              "requestId": "MOMO1732000000000",
              "amount": "70000",
              "orderInfo": "Thanh toán MoMo - 4Foods",
              "extraData": "eyJ1c2VySWQiOiI2NzJmYWVjODZkYyIsIml0ZW1zIjpbXX0=",
              "message": "Successful.",
              "resultCode": 0,
              "payType": "qr",
              "signature": "hmacsha256hex"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Order created",
            "examples": {
              "application/json": {
                "message": "Order created",
                "order": {
                  "_id": "6730c1aaeede7ef016ca9300",
                  "paymentMethod": "momo",
                  "status": "processing",
                  "total": 70000
                }
              }
            }
          },
          "400": {
            "description": "Invalid signature",
            "examples": {
              "application/json": { "message": "Invalid signature" }
            }
          }
        }
      }
    },

    "/orders/momo/return": {
      "get": {
        "tags": ["Order"],
        "summary": "MoMo redirect return page",
        "parameters": [
          {
            "in": "query",
            "name": "resultCode",
            "type": "string",
            "example": "0"
          }
        ],
        "responses": {
          "200": {
            "description": "HTML result",
            "examples": {
              "text/html": "Thanh toán thành công. Bạn có thể đóng trang này."
            }
          }
        }
      }
    },

    "/orders/{orderId}/cancel": {
      "put": {
        "tags": ["Order"],
        "summary": "User cancel order (processing only)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "orderId",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "6730b6f2afc9e7f016ca927d"
          }
        ],
        "responses": {
          "200": {
            "description": "Cancelled",
            "examples": {
              "application/json": {
                "message": "Order cancelled successfully",
                "order": {
                  "_id": "6730b6f2afc9e7f016ca927d",
                  "status": "cancelled"
                }
              }
            }
          },
          "400": {
            "description": "Not cancellable",
            "examples": {
              "application/json": {
                "error": "Cannot cancel, order not processing"
              }
            }
          },
          "404": { "description": "Not found" }
        }
      }
    },

    "/orders/{orderId}/refund": {
      "post": {
        "tags": ["Order"],
        "summary": "User request refund (delivered)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "orderId",
            "in": "path",
            "type": "string",
            "required": true,
            "example": "6730d1aaeede7ef016ca9311"
          },
          {
            "in": "body",
            "name": "body",
            "schema": { "type": "object", "required": ["reason"] },
            "example": { "reason": "Sản phẩm bị hư hỏng" }
          }
        ],
        "responses": {
          "200": {
            "description": "Requested",
            "examples": {
              "application/json": {
                "message": "Refund request sent",
                "order": {
                  "_id": "6730d1aaeede7ef016ca9311",
                  "refundRequest": {
                    "status": "pending",
                    "reason": "Sản phẩm bị hư hỏng"
                  }
                }
              }
            }
          },
          "400": {
            "description": "Invalid state",
            "examples": {
              "application/json": {
                "error": "Refund only available for delivered orders"
              }
            }
          }
        }
      },
      "put": {
        "tags": ["Order"],
        "summary": "Seller accept/reject refund",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "orderId",
            "in": "path",
            "type": "string",
            "required": true,
            "example": "6730d1aaeede7ef016ca9311"
          },
          {
            "in": "body",
            "name": "body",
            "schema": { "type": "object", "required": ["action"] },
            "example": { "action": "accept" }
          }
        ],
        "responses": {
          "200": {
            "description": "Processed",
            "examples": {
              "application/json": {
                "message": "Refund accept",
                "order": {
                  "_id": "6730d1aaeede7ef016ca9311",
                  "refundRequest": { "status": "accepted" }
                }
              }
            }
          },
          "400": {
            "description": "No pending",
            "examples": {
              "application/json": { "error": "No processing refund request" }
            }
          }
        }
      }
    },

    "/orders/refunds": {
      "get": {
        "tags": ["Order"],
        "summary": "Seller list pending refunds",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "List",
            "examples": {
              "application/json": [
                {
                  "_id": "6730d1aaeede7ef016ca9311",
                  "status": "delivered",
                  "refundRequest": {
                    "status": "pending",
                    "reason": "Sai sản phẩm"
                  }
                }
              ]
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": { "application/json": { "error": "Only for sellers" } }
          }
        }
      }
    },

    "/orders/all-tabs": {
      "get": {
        "tags": ["Order"],
        "summary": "User order tabs",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "Categorized",
            "examples": {
              "application/json": {
                "ongoing": [
                  {
                    "_id": "6730e2f2afc9e7f016ca9400",
                    "status": "processing",
                    "total": 55000
                  }
                ],
                "history": [
                  {
                    "_id": "6730e2f2afc9e7f016ca9401",
                    "status": "delivered",
                    "total": 82000
                  }
                ],
                "deals": [
                  {
                    "voucherCode": "SALE10",
                    "discountValue": 10,
                    "totalDiscount": 10000
                  }
                ],
                "review": [
                  {
                    "orderId": "6730e2f2afc9e7f016ca9401",
                    "productId": "6730b2ac1b7c5d84e843a932",
                    "name": "Trà Sữa Truyền Thống"
                  }
                ]
              }
            }
          }
        }
      }
    },

    "/orders/all": {
      "get": {
        "tags": ["Order"],
        "summary": "Admin/Seller all orders",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "List",
            "examples": {
              "application/json": [
                {
                  "_id": "6730b6f2afc9e7f016ca927d",
                  "user": { "name": "Triet", "email": "user@4foods.app" },
                  "total": 70000,
                  "status": "processing"
                }
              ]
            }
          }
        }
      }
    },

    "/orders/{orderId}": {
      "get": {
        "tags": ["Order"],
        "summary": "Get order details",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "orderId",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "6730b6f2afc9e7f016ca927d"
          }
        ],
        "responses": {
          "200": {
            "description": "Details",
            "examples": {
              "application/json": {
                "_id": "6730b6f2afc9e7f016ca927d",
                "user": {
                  "name": "Triet",
                  "email": "user@4foods.app",
                  "phone": "0912345678"
                },
                "items": [
                  {
                    "product": {
                      "name": "Trà Sữa Truyền Thống",
                      "image": "https://cdn.4foods.app/p/tra-sua.jpg",
                      "prepTime": 5,
                      "price": 30000,
                      "stock": 100
                    },
                    "quantity": 2
                  }
                ],
                "subtotal": 60000,
                "discount": 5000,
                "deliveryFee": 15000,
                "total": 70000,
                "status": "processing"
              }
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": {
              "application/json": {
                "error": "Forbidden: You cannot view this order"
              }
            }
          },
          "404": {
            "description": "Not found",
            "examples": { "application/json": { "error": "Order not found" } }
          }
        }
      }
    },

    "/orders/{orderId}/status": {
      "put": {
        "tags": ["Order"],
        "summary": "Update order status (seller only)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "orderId",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "6730b6f2afc9e7f016ca927d"
          },
          {
            "in": "body",
            "name": "body",
            "schema": {
              "type": "object",
              "required": ["status"],
              "properties": {
                "status": {
                  "type": "string",
                  "enum": ["processing", "delivered", "cancelled"]
                }
              }
            },
            "example": { "status": "delivered" }
          }
        ],
        "responses": {
          "200": {
            "description": "Updated",
            "examples": {
              "application/json": {
                "message": "Order status updated",
                "order": {
                  "_id": "6730b6f2afc9e7f016ca927d",
                  "status": "delivered"
                }
              }
            }
          },
          "400": {
            "description": "Invalid",
            "examples": { "application/json": { "error": "Invalid status" } }
          },
          "403": {
            "description": "Forbidden",
            "examples": { "application/json": { "error": "Forbidden" } }
          },
          "404": { "description": "Not found" }
        }
      }
    },

    "/orders/stats": {
      "get": {
        "tags": ["Order"],
        "summary": "Order stats (seller/all)",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "Stats",
            "examples": {
              "application/json": { "totalOrders": 42, "totalRevenue": 3560000 }
            }
          }
        }
      }
    },

    "/shops/register": {
      "post": {
        "tags": ["Shop"],
        "summary": "Register a new shop (User only)",
        "security": [{ "Bearer": [] }],
        "consumes": ["application/json"],
        "produces": ["application/json"],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "name": { "type": "string", "example": "Tiệm Trà Sữa Posu" },
                "phone": { "type": "string", "example": "0987654321" },
                "address": {
                  "type": "string",
                  "example": "123 Đường Hàn Thuyên"
                },
                "representative": {
                  "type": "object",
                  "example": {
                    "fullName": "Posu Do",
                    "email": "posu@example.com",
                    "phone": "0987654321",
                    "idNumber": "123456789",
                    "idIssuedDate": "2024-01-10",
                    "idIssuedPlace": "TPHCM",
                    "idCardFront": "https://cdn.com/idfront.jpg",
                    "idCardBack": "https://cdn.com/idback.jpg",
                    "businessLicenseFront": "https://cdn.com/blf.jpg",
                    "businessLicenseBack": "https://cdn.com/blb.jpg",
                    "taxCertificate": "https://cdn.com/tax.jpg"
                  }
                },
                "bank": {
                  "type": "object",
                  "example": {
                    "bankName": "Vietcombank",
                    "accountNumber": "1234567890",
                    "branch": "Chi nhánh Thủ Đức",
                    "accountHolder": "Posu Do"
                  }
                },
                "openHours": {
                  "type": "object",
                  "example": {
                    "sameAllWeek": true,
                    "monday": { "open": "08:00", "close": "22:00" }
                  }
                },
                "avatar": {
                  "type": "string",
                  "example": "https://cdn.com/avatar.jpg"
                },
                "cover": {
                  "type": "string",
                  "example": "https://cdn.com/cover.jpg"
                },
                "frontImage": {
                  "type": "string",
                  "example": "https://cdn.com/front.jpg"
                },
                "serviceCategory": {
                  "type": "string",
                  "example": "67335e524f02e1bd16f9a88c"
                },
                "cuisineCategory": {
                  "type": "string",
                  "example": "67335e524f02e1bd16f9a88d"
                },
                "productCategory": {
                  "type": "string",
                  "example": "67335e524f02e1bd16f9a88e"
                }
              },
              "required": ["name", "phone", "address"]
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Shop created successfully",
            "schema": {
              "type": "object",
              "example": {
                "message": "Shop registered and pending approval",
                "shop": {
                  "_id": "6733f0d024f23c6f9c28a77d",
                  "name": "Tiệm Trà Sữa Posu",
                  "status": "pending",
                  "createdAt": "2025-11-03T10:23:00Z"
                }
              }
            }
          },
          "400": {
            "description": "User can have only 1 shop or missing fields"
          },
          "500": { "description": "Server error" }
        }
      }
    },

    "/shops": {
      "get": {
        "tags": ["Shop"],
        "summary": "Get shops (admin gets all, user gets their own)",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "List of shops",
            "schema": {
              "type": "array",
              "example": [
                {
                  "_id": "6733f0d024f23c6f9c28a77d",
                  "name": "Tiệm Trà Sữa Posu",
                  "status": "pending",
                  "owner": {
                    "_id": "672f8e1f88e4b00e2b07c211",
                    "name": "Do Posu",
                    "email": "posu@example.com"
                  },
                  "serviceCategory": {
                    "_id": "67335e524f02e1bd16f9a88c",
                    "name": "Ăn uống"
                  }
                }
              ]
            }
          }
        }
      }
    },

    "/shops/{id}": {
      "get": {
        "tags": ["Shop"],
        "summary": "Get shop details by ID",
        "security": [{ "Bearer": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "type": "string" }
        ],
        "responses": {
          "200": {
            "description": "Shop details",
            "schema": {
              "type": "object",
              "example": {
                "_id": "6733f0d024f23c6f9c28a77d",
                "name": "Tiệm Trà Sữa Posu",
                "status": "pending",
                "address": "123 Đường Hàn Thuyên",
                "owner": {
                  "_id": "672f8e1f88e4b00e2b07c211",
                  "name": "Do Posu"
                }
              }
            }
          },
          "404": { "description": "Shop not found" }
        }
      },
      "put": {
        "tags": ["Shop"],
        "summary": "Update shop info (owner or admin)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "type": "string" },
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "example": {
                "name": "Tiệm Posu Tea - Cập nhật",
                "phone": "0912345678",
                "address": "456 Linh Trung, Thủ Đức"
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Shop updated",
            "schema": {
              "type": "object",
              "example": {
                "_id": "6733f0d024f23c6f9c28a77d",
                "name": "Tiệm Posu Tea - Cập nhật"
              }
            }
          },
          "400": { "description": "Approved shop can't be edited" },
          "403": { "description": "Forbidden" },
          "404": { "description": "Shop not found" }
        }
      },
      "delete": {
        "tags": ["Shop"],
        "summary": "Delete a shop (Admin only)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "type": "string" }
        ],
        "responses": {
          "200": {
            "description": "Shop deleted",
            "schema": {
              "type": "object",
              "example": { "message": "Shop deleted" }
            }
          },
          "404": { "description": "Shop not found" }
        }
      }
    },

    "/shops/{id}/approve": {
      "put": {
        "tags": ["Shop"],
        "summary": "Approve or reject shop (Admin only)",
        "security": [{ "Bearer": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "type": "string" },
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "status": {
                  "type": "string",
                  "enum": ["approved", "rejected", "pending"],
                  "example": "approved"
                },
                "reason": {
                  "type": "string",
                  "example": "Không đủ giấy tờ kinh doanh"
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Shop approval updated",
            "schema": {
              "type": "object",
              "example": { "message": "Shop status updated to approved" }
            }
          },
          "400": { "description": "Invalid status" },
          "404": { "description": "Shop not found" }
        }
      }
    },

    "/shops/{id}/toggle-open": {
      "put": {
        "tags": ["Shop"],
        "summary": "Toggle shop open/closed (Owner or Admin)",
        "description": "Cho phép chủ shop hoặc admin bật/tắt trạng thái mở cửa shop. Khi shop đóng, người dùng sẽ không thể xem hoặc tìm thấy shop và sản phẩm của shop đó.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "description": "Shop ID cần thay đổi trạng thái"
          }
        ],
        "responses": {
          "200": {
            "description": "Shop open state toggled",
            "schema": {
              "type": "object",
              "example": { "message": "Shop is now open", "isOpen": true }
            }
          },
          "403": {
            "description": "Forbidden – Chỉ admin hoặc chủ shop được phép thay đổi trạng thái"
          },
          "404": { "description": "Shop not found" },
          "500": { "description": "Server error" }
        }
      }
    },

    "/categories": {
      "get": {
        "tags": ["Category"],
        "summary": "Get all categories",
        "description": "Retrieve all categories. You can filter by `type` and/or `parent` using query parameters.",
        "parameters": [
          {
            "name": "type",
            "in": "query",
            "description": "Filter categories by type (service, cuisine, or product)",
            "required": false,
            "type": "string",
            "enum": ["service", "cuisine", "product"]
          },
          {
            "name": "parent",
            "in": "query",
            "description": "Filter by parent category ID",
            "required": false,
            "type": "string"
          }
        ],
        "responses": {
          "200": {
            "description": "List of categories",
            "examples": {
              "application/json": [
                {
                  "_id": "671d9bfa9828f2b7a1c2ef5d",
                  "type": "product",
                  "name": "Trà sữa",
                  "parent": null,
                  "description": "Các loại trà sữa phổ biến",
                  "createdAt": "2025-11-03T10:00:00.000Z",
                  "updatedAt": "2025-11-03T10:00:00.000Z"
                }
              ]
            }
          }
        }
      },
      "post": {
        "tags": ["Category"],
        "summary": "Create a new category",
        "description": "Admin only. Creates a new category (service, cuisine, or product).",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": { "type": "object" },
            "example": {
              "type": "product",
              "name": "Trà sữa",
              "parent": null,
              "description": "Các loại trà sữa phổ biến"
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Category created successfully",
            "examples": {
              "application/json": {
                "_id": "671d9bfa9828f2b7a1c2ef5d",
                "type": "product",
                "name": "Trà sữa",
                "parent": null,
                "description": "Các loại trà sữa phổ biến",
                "createdAt": "2025-11-03T10:00:00.000Z",
                "updatedAt": "2025-11-03T10:00:00.000Z"
              }
            }
          },
          "400": {
            "description": "Validation error",
            "examples": { "application/json": { "error": "Type is required" } }
          }
        }
      }
    },

    "/categories/{id}": {
      "get": {
        "tags": ["Category"],
        "summary": "Get category by ID",
        "description": "Retrieve a category by its ID.",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "description": "Category ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Category details",
            "examples": {
              "application/json": {
                "_id": "671d9bfa9828f2b7a1c2ef5d",
                "type": "product",
                "name": "Trà sữa",
                "parent": null,
                "description": "Các loại trà sữa phổ biến",
                "createdAt": "2025-11-03T10:00:00.000Z",
                "updatedAt": "2025-11-03T10:00:00.000Z"
              }
            }
          },
          "404": {
            "description": "Category not found",
            "examples": {
              "application/json": { "error": "Category not found" }
            }
          }
        }
      },
      "put": {
        "tags": ["Category"],
        "summary": "Update category",
        "description": "Admin only. Update category fields by ID.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "description": "Category ID"
          },
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": { "type": "object" },
            "example": {
              "name": "Trà sữa đặc biệt",
              "description": "Trà sữa với topping đặc biệt"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Category updated successfully",
            "examples": {
              "application/json": {
                "_id": "671d9bfa9828f2b7a1c2ef5d",
                "type": "product",
                "name": "Trà sữa đặc biệt",
                "parent": null,
                "description": "Trà sữa với topping đặc biệt",
                "createdAt": "2025-11-03T10:00:00.000Z",
                "updatedAt": "2025-11-03T10:05:00.000Z"
              }
            }
          },
          "404": {
            "description": "Category not found",
            "examples": {
              "application/json": { "error": "Category not found" }
            }
          }
        }
      },
      "delete": {
        "tags": ["Category"],
        "summary": "Delete category",
        "description": "Admin only. Delete a category and its subcategories.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "description": "Category ID"
          }
        ],
        "responses": {
          "200": {
            "description": "Category deleted successfully",
            "examples": { "application/json": { "message": "Deleted" } }
          },
          "404": {
            "description": "Category not found",
            "examples": {
              "application/json": { "error": "Category not found" }
            }
          }
        }
      }
    },

    "/notifications/me": {
      "get": {
        "tags": ["Notification"],
        "summary": "Get notifications of the current user",
        "description": "Returns a list of notifications belonging to the authenticated user. Can be filtered by type (order, promo, system, wallet) and targetType (user, seller, admin).",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "query",
            "name": "type",
            "required": false,
            "description": "Filter by notification type (order, promo, system, wallet)",
            "type": "string",
            "enum": ["order", "promo", "system", "wallet"]
          },
          {
            "in": "query",
            "name": "targetType",
            "required": false,
            "description": "Filter by target type of notifications (user, seller, admin)",
            "type": "string",
            "enum": ["user", "seller", "admin"]
          }
        ],
        "responses": {
          "200": {
            "description": "List of notifications for the current user",
            "examples": {
              "application/json": [
                {
                  "_id": "67275ad3b7f11a1234aef789",
                  "user": "67245abcde9b11a4d11f2345",
                  "sender": "671acdb4f123aa12000de789",
                  "message": "Your shop has been approved.",
                  "type": "system",
                  "targetType": "seller",
                  "metadata": {
                    "shopId": "671bcaa9f00a55222b44cc11",
                    "status": "approved"
                  },
                  "read": false,
                  "createdAt": "2025-11-03T09:35:00.123Z",
                  "updatedAt": "2025-11-03T09:35:00.123Z"
                }
              ]
            }
          },
          "401": { "description": "Unauthorized" }
        }
      }
    },

    "/notifications/{id}/read": {
      "put": {
        "tags": ["Notification"],
        "summary": "Mark a notification as read",
        "description": "Marks a specific notification belonging to the current user as read.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "path",
            "name": "id",
            "required": true,
            "type": "string",
            "description": "Notification ID to mark as read"
          }
        ],
        "responses": {
          "200": {
            "description": "Notification successfully marked as read",
            "examples": {
              "application/json": {
                "_id": "67275ad3b7f11a1234aef789",
                "user": "67245abcde9b11a4d11f2345",
                "sender": "671acdb4f123aa12000de789",
                "message": "Your shop has been approved.",
                "type": "system",
                "targetType": "seller",
                "metadata": {
                  "shopId": "671bcaa9f00a55222b44cc11",
                  "status": "approved"
                },
                "read": true,
                "createdAt": "2025-11-03T09:35:00.123Z",
                "updatedAt": "2025-11-03T09:37:10.000Z"
              }
            }
          },
          "404": { "description": "Notification not found" },
          "401": { "description": "Unauthorized" }
        }
      }
    },

    "/notifications": {
      "get": {
        "tags": ["Notification"],
        "summary": "Get all notifications (admin)",
        "description": "Admin can view all notifications in the system.",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "List of all notifications in the system",
            "examples": {
              "application/json": [
                {
                  "_id": "67275ad3b7f11a1234aef789",
                  "user": {
                    "_id": "67245abcde9b11a4d11f2345",
                    "name": "Nguyen Van A",
                    "email": "a@example.com"
                  },
                  "sender": "671acdb4f123aa12000de789",
                  "message": "50% off on all menu items!",
                  "type": "promo",
                  "targetType": "user",
                  "metadata": {},
                  "read": false,
                  "createdAt": "2025-11-03T09:35:00.123Z",
                  "updatedAt": "2025-11-03T09:35:00.123Z"
                }
              ]
            }
          },
          "403": { "description": "Forbidden - admin access only" }
        }
      },
      "post": {
        "tags": ["Notification"],
        "summary": "Send notification (admin)",
        "description": "Admin can send a notification to a specific user or broadcast it to all users.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "userId": {
                  "type": "string",
                  "description": "User ID to send notification to (leave empty to send to all users)"
                },
                "message": {
                  "type": "string",
                  "example": "The system will undergo maintenance at 10:00 PM."
                },
                "type": {
                  "type": "string",
                  "enum": ["order", "promo", "system"],
                  "example": "system"
                },
                "metadata": {
                  "type": "object",
                  "example": { "maintenanceTime": "22:00" }
                },
                "targetType": {
                  "type": "string",
                  "enum": ["user", "seller", "admin"],
                  "example": "user"
                }
              },
              "required": ["message"]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Notification successfully sent",
            "examples": {
              "application/json": {
                "_id": "67276111b7f11a1234aef789",
                "user": "67245abcde9b11a4d11f2345",
                "message": "The system will undergo maintenance at 10:00 PM.",
                "type": "system",
                "targetType": "user",
                "metadata": { "maintenanceTime": "22:00" },
                "read": false,
                "createdAt": "2025-11-03T09:45:00.000Z",
                "updatedAt": "2025-11-03T09:45:00.000Z"
              }
            }
          },
          "403": { "description": "Forbidden - admin access only" },
          "500": { "description": "Server error" }
        }
      }
    },

    "/voucher/system": {
      "post": {
        "tags": ["Voucher"],
        "summary": "Create a system voucher (Admin only)",
        "description": "Admin creates a voucher issued by the system, not tied to any shop.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "code": { "type": "string" },
                "name": { "type": "string" },
                "description": { "type": "string" },
                "discountType": {
                  "type": "string",
                  "enum": ["percentage", "fixed"]
                },
                "discountValue": { "type": "number" },
                "minOrder": { "type": "number" },
                "maxDiscount": { "type": "number" },
                "startDate": { "type": "string", "format": "date-time" },
                "endDate": { "type": "string", "format": "date-time" },
                "quantity": { "type": "integer" },
                "paymentMethods": {
                  "type": "array",
                  "items": { "type": "string" }
                },
                "shippingMethods": {
                  "type": "array",
                  "items": { "type": "string" }
                },
                "applicableProducts": {
                  "type": "array",
                  "items": { "type": "string" }
                },
                "applicableUsers": {
                  "type": "array",
                  "items": { "type": "string" }
                },
                "note": { "type": "string" }
              },
              "example": {
                "code": "SYSNEWYEAR",
                "name": "New Year 10% Off",
                "description": "Get 10% off for all system-wide orders",
                "discountType": "percentage",
                "discountValue": 10,
                "minOrder": 100000,
                "maxDiscount": 50000,
                "startDate": "2025-12-30T00:00:00Z",
                "endDate": "2026-01-05T23:59:59Z",
                "quantity": 500,
                "paymentMethods": ["credit_card", "cod"],
                "shippingMethods": ["standard", "express"],
                "note": "Valid only during holiday season"
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "System voucher created successfully",
            "examples": {
              "application/json": {
                "success": true,
                "voucher": {
                  "_id": "voucherId",
                  "code": "SYSNEWYEAR",
                  "remaining": 500
                }
              }
            }
          },
          "500": { "description": "Internal server error" }
        }
      }
    },

    "/voucher/{id}": {
      "put": {
        "tags": ["Voucher"],
        "summary": "Update a voucher (Admin only)",
        "description": "Admin updates a voucher’s details.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "type": "string" },
          {
            "in": "body",
            "name": "body",
            "schema": {
              "type": "object",
              "example": { "name": "Updated voucher name", "discountValue": 15 }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Voucher updated successfully",
            "examples": {
              "application/json": {
                "success": true,
                "message": "Voucher updated successfully"
              }
            }
          },
          "404": { "description": "Voucher not found" }
        }
      },
      "delete": {
        "tags": ["Voucher"],
        "summary": "Delete a voucher (Admin only)",
        "description": "Admin deletes a voucher by ID.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          { "name": "id", "in": "path", "required": true, "type": "string" }
        ],
        "responses": {
          "200": {
            "description": "Voucher deleted successfully",
            "examples": {
              "application/json": {
                "success": true,
                "message": "Voucher deleted successfully"
              }
            }
          }
        }
      }
    },

    "/voucher/shop": {
      "post": {
        "tags": ["Voucher"],
        "summary": "Create a shop voucher (Seller only)",
        "description": "Seller creates a voucher tied to their own shop.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "example": {
                "code": "SHOP10",
                "name": "10% Off in My Shop",
                "description": "Get 10% off on all items in this shop",
                "discountType": "percentage",
                "discountValue": 10,
                "minOrder": 50000,
                "maxDiscount": 20000,
                "startDate": "2025-11-01T00:00:00Z",
                "endDate": "2025-12-01T00:00:00Z",
                "quantity": 100
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Shop voucher created successfully",
            "examples": {
              "application/json": {
                "success": true,
                "voucher": { "code": "SHOP10", "shop": "shopId" }
              }
            }
          }
        }
      }
    },

    "/voucher/shop/{shopId}": {
      "get": {
        "tags": ["Voucher"],
        "summary": "Get active vouchers of a specific shop (User/Seller)",
        "description": "Retrieve all active vouchers available for a shop.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          { "name": "shopId", "in": "path", "required": true, "type": "string" }
        ],
        "responses": {
          "200": {
            "description": "List of active vouchers from the shop",
            "examples": {
              "application/json": {
                "success": true,
                "vouchers": [{ "code": "SHOP10", "name": "10% Off in My Shop" }]
              }
            }
          }
        }
      }
    },

    "/voucher/mine": {
      "get": {
        "tags": ["Voucher"],
        "summary": "Get all vouchers created by seller (Seller only)",
        "description": "Seller retrieves all vouchers that belong to their shop.",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "List of vouchers created by this seller",
            "examples": {
              "application/json": {
                "success": true,
                "vouchers": [{ "code": "SHOP10", "discountType": "percentage" }]
              }
            }
          }
        }
      }
    },

    "/voucher/collect/{voucherId}": {
      "post": {
        "tags": ["Voucher"],
        "summary": "Collect a voucher into wallet (User only)",
        "description": "User collects a voucher from shop or system into their wallet.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "voucherId",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "responses": {
          "200": {
            "description": "Voucher collected successfully",
            "examples": {
              "application/json": {
                "success": true,
                "message": "Voucher added to your wallet"
              }
            }
          },
          "400": { "description": "Voucher already collected or out of stock" }
        }
      }
    },

    "/voucher/wallet": {
      "get": {
        "tags": ["Voucher"],
        "summary": "Get vouchers in wallet (User only)",
        "description": "Retrieve vouchers that user has collected, separated into system and shop vouchers.",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "Vouchers grouped by type",
            "examples": {
              "application/json": {
                "success": true,
                "systemVouchers": [
                  { "code": "SYSNEWYEAR", "name": "New Year 10% Off" }
                ],
                "shopVouchers": [{ "code": "SHOP10", "shop": "Shop A" }]
              }
            }
          }
        }
      }
    },

    "/upload/{type}": {
      "post": {
        "tags": ["Upload"],
        "summary": "Upload an image to Cloudinary",
        "description": "Uploads a single image file to Cloudinary under the specified type folder. Authentication is required.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "type",
            "in": "path",
            "description": "Type or category of the image (e.g. `product`, `avatar`, `voucher`, etc.)",
            "required": true,
            "type": "string"
          },
          {
            "name": "image",
            "in": "formData",
            "description": "The image file to be uploaded",
            "required": true,
            "type": "file"
          }
        ],
        "responses": {
          "200": {
            "description": "Upload successful",
            "examples": {
              "application/json": {
                "message": "Upload successful",
                "url": "https://res.cloudinary.com/4foods/image/upload/v1234567890/product/abc123.jpg",
                "public_id": "product/abc123"
              }
            }
          },
          "400": {
            "description": "No file uploaded or invalid request",
            "examples": { "application/json": { "error": "No file uploaded" } }
          },
          "401": {
            "description": "Unauthorized (missing or invalid token)",
            "examples": {
              "application/json": { "error": "Invalid or expired token" }
            }
          },
          "500": {
            "description": "Internal server error during upload",
            "examples": {
              "application/json": { "error": "Cloudinary upload failed" }
            }
          }
        }
      }
    },

    "/cart": {
      "get": {
        "tags": ["Cart"],
        "summary": "Lấy giỏ hàng hiện tại của user",
        "description": "Nếu chưa tồn tại sẽ tự tạo giỏ hàng rỗng.",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "Giỏ hàng hiện tại",
            "examples": {
              "application/json": {
                "_id": "6755abc12f9d3e0012345678",
                "user": "6731111aaa2222bbb3333ccc",
                "items": [
                  {
                    "_id": "6755abd22f9d3e0012345679",
                    "product": {
                      "_id": "67310df7d9c6a8f016ca9123",
                      "name": "Trà Sữa Truyền Thống",
                      "price": 30000,
                      "stock": 120,
                      "imageUrl": "https://cdn.4foods.app/p/tra-sua.jpg",
                      "prepTime": 5,
                      "shop": "6733f0d024f23c6f9c28a77d",
                      "shopId": {
                        "_id": "6733f0d024f23c6f9c28a77d",
                        "name": "Tiệm Trà Sữa Triet"
                      }
                    },
                    "quantity": 2
                  }
                ],
                "updatedAt": "2025-11-21T09:15:00.000Z",
                "createdAt": "2025-11-21T09:10:00.000Z"
              }
            }
          },
          "401": {
            "description": "Không có hoặc token không hợp lệ",
            "examples": { "application/json": { "error": "Unauthorized" } }
          },
          "500": {
            "description": "Lỗi server",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      }
    },
    "/cart/add": {
      "post": {
        "tags": ["Cart"],
        "summary": "Thêm sản phẩm vào giỏ",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "required": ["productId"],
              "properties": {
                "productId": { "type": "string" },
                "quantity": { "type": "integer", "minimum": 1, "default": 1 }
              }
            },
            "example": {
              "productId": "67310df7d9c6a8f016ca9123",
              "quantity": 2
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Giỏ hàng sau khi thêm/cộng dồn",
            "examples": {
              "application/json": {
                "_id": "6755abc12f9d3e0012345678",
                "user": "6731111aaa2222bbb3333ccc",
                "items": [
                  {
                    "_id": "6755abd22f9d3e0012345679",
                    "product": {
                      "_id": "67310df7d9c6a8f016ca9123",
                      "name": "Trà Sữa Truyền Thống",
                      "price": 30000,
                      "stock": 120,
                      "imageUrl": "https://cdn.4foods.app/p/tra-sua.jpg",
                      "prepTime": 5,
                      "shop": "6733f0d024f23c6f9c28a77d",
                      "shopId": {
                        "_id": "6733f0d024f23c6f9c28a77d",
                        "name": "Tiệm Trà Sữa Triet"
                      }
                    },
                    "quantity": 3
                  }
                ],
                "updatedAt": "2025-11-21T09:20:00.000Z"
              }
            }
          },
          "404": {
            "description": "Không tìm thấy sản phẩm",
            "examples": { "application/json": { "error": "Product not found" } }
          },
          "400": {
            "description": "Vượt quá số lượng tồn kho",
            "examples": { "application/json": { "error": "Not enough stock" } }
          },
          "401": {
            "description": "Không có hoặc token không hợp lệ",
            "examples": { "application/json": { "error": "Unauthorized" } }
          },
          "500": {
            "description": "Lỗi server",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      }
    },
    "/cart/update": {
      "put": {
        "tags": ["Cart"],
        "summary": "Cập nhật số lượng sản phẩm trong giỏ",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "required": ["productId", "quantity"],
              "properties": {
                "productId": { "type": "string" },
                "quantity": { "type": "integer", "minimum": 1 }
              }
            },
            "example": {
              "productId": "67310df7d9c6a8f016ca9123",
              "quantity": 5
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Giỏ hàng sau cập nhật",
            "examples": {
              "application/json": {
                "_id": "6755abc12f9d3e0012345678",
                "user": "6731111aaa2222bbb3333ccc",
                "items": [
                  {
                    "_id": "6755abd22f9d3e0012345679",
                    "product": {
                      "_id": "67310df7d9c6a8f016ca9123",
                      "name": "Trà Sữa Truyền Thống",
                      "price": 30000,
                      "stock": 120,
                      "imageUrl": "https://cdn.4foods.app/p/tra-sua.jpg",
                      "prepTime": 5,
                      "shop": "6733f0d024f23c6f9c28a77d",
                      "shopId": {
                        "_id": "6733f0d024f23c6f9c28a77d",
                        "name": "Tiệm Trà Sữa Triet"
                      }
                    },
                    "quantity": 5
                  }
                ],
                "updatedAt": "2025-11-21T09:25:00.000Z"
              }
            }
          },
          "400": {
            "description": "Số lượng không hợp lệ",
            "examples": {
              "application/json": {
                "message": "Quantity is 0. Do you want to remove this product from cart?"
              }
            }
          },
          "400-2": {
            "description": "Vượt quá tồn kho",
            "examples": { "application/json": { "error": "Not enough stock" } }
          },
          "404": {
            "description": "Không tìm thấy sản phẩm hoặc giỏ hàng",
            "examples": {
              "application/json": { "error": "Product not in cart" }
            }
          },
          "401": {
            "description": "Không có hoặc token không hợp lệ",
            "examples": { "application/json": { "error": "Unauthorized" } }
          },
          "500": {
            "description": "Lỗi server",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      }
    },

    "/cart/remove/{productId}": {
      "delete": {
        "tags": ["Cart"],
        "summary": "Remove item from cart",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "productId",
            "in": "path",
            "required": true,
            "type": "string"
          }
        ],
        "responses": {
          "200": {
            "description": "Item removed successfully",
            "schema": { "example": { "message": "Product removed from cart" } }
          }
        }
      }
    },

    "/cart/clear": {
      "delete": {
        "tags": ["Cart"],
        "summary": "Clear all items from cart",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "Cart cleared successfully",
            "schema": { "example": { "message": "Cart cleared" } }
          }
        }
      }
    },

    "/chat/conversation": {
      "post": {
        "tags": ["Chat"],
        "summary": "Create or get conversation with another user",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "required": ["partnerId"],
              "properties": {
                "partnerId": {
                  "type": "string",
                  "example": "64f123abc456def789012345"
                }
              }
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Conversation object",
            "examples": {
              "application/json": {
                "_id": "64f123abc456def789012345",
                "participants": [
                  "64f123abc456def789012345",
                  "64f987xyz456def789012345"
                ],
                "isAI": false,
                "createdAt": "2025-11-18T08:21:55.849Z",
                "updatedAt": "2025-11-18T08:21:55.849Z"
              }
            }
          },
          "400": {
            "description": "Missing partnerId",
            "examples": { "application/json": { "error": "Missing partnerId" } }
          },
          "404": {
            "description": "Partner not found",
            "examples": { "application/json": { "error": "Partner not found" } }
          },
          "500": {
            "description": "Server error",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      },
      "get": {
        "tags": ["Chat"],
        "summary": "Get all conversations of current user",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "List of conversations",
            "examples": {
              "application/json": [
                {
                  "_id": "64f123abc456def789012345",
                  "participants": [
                    "64f123abc456def789012345",
                    "64f987xyz456def789012345"
                  ],
                  "isAI": false,
                  "updatedAt": "2025-11-18T08:21:55.849Z"
                }
              ]
            }
          },
          "500": {
            "description": "Server error",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      }
    },

    "/chat/messages/{id}": {
      "get": {
        "tags": ["Chat"],
        "summary": "Get messages of a conversation",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "description": "Conversation ID"
          }
        ],
        "responses": {
          "200": {
            "description": "List of messages",
            "examples": {
              "application/json": [
                {
                  "_id": "64f999abc456def789012345",
                  "conversationId": "64f123abc456def789012345",
                  "sender": {
                    "_id": "64f123abc456def789012345",
                    "name": "Posu",
                    "email": "posu@example.com",
                    "avatar": "",
                    "role": "user"
                  },
                  "receiver": "64f987xyz456def789012345",
                  "text": "Xin chào!",
                  "image": "",
                  "createdAt": "2025-11-18T08:21:55.849Z"
                }
              ]
            }
          },
          "403": {
            "description": "Forbidden",
            "examples": { "application/json": { "error": "Forbidden" } }
          },
          "404": {
            "description": "Conversation not found",
            "examples": {
              "application/json": { "error": "Conversation not found" }
            }
          },
          "500": {
            "description": "Server error",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      }
    },

    "/chat/message": {
      "post": {
        "tags": ["Chat"],
        "summary": "Send a message in a conversation",
        "security": [{ "Bearer": [] }],
        "consumes": ["multipart/form-data"],
        "parameters": [
          {
            "name": "conversationId",
            "in": "formData",
            "required": true,
            "type": "string",
            "description": "Conversation ID"
          },
          {
            "name": "text",
            "in": "formData",
            "required": false,
            "type": "string",
            "description": "Message text"
          },
          {
            "name": "image",
            "in": "formData",
            "required": false,
            "type": "file",
            "description": "Image file to upload"
          }
        ],
        "responses": {
          "201": {
            "description": "Message sent",
            "examples": {
              "application/json": {
                "_id": "64f999abc456def789012345",
                "conversationId": "64f123abc456def789012345",
                "sender": {
                  "_id": "64f123abc456def789012345",
                  "name": "Posu",
                  "email": "posu@example.com",
                  "avatar": "",
                  "role": "user"
                },
                "receiver": "64f987xyz456def789012345",
                "text": "Xin chào!",
                "image": "https://res.cloudinary.com/xxx/image/upload/v1234567890/messages/abc.png",
                "createdAt": "2025-11-18T08:21:55.849Z"
              }
            }
          },
          "404": {
            "description": "Conversation not found",
            "examples": {
              "application/json": { "error": "Conversation not found" }
            }
          },
          "500": {
            "description": "Server error",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      }
    },

    "/recommend/top-products": {
      "get": {
        "tags": ["Recommend"],
        "summary": "Get top-selling products",
        "description": "Trả về danh sách sản phẩm hot / bán chạy nhất.",
        "responses": {
          "200": {
            "description": "List of top products",
            "examples": {
              "application/json": [
                {
                  "_id": "69104d35ad02ab999d92ae1a",
                  "name": "Trà Sữa Truyền Thống Thập Cẩm",
                  "price": 30000,
                  "discountPercent": 70,
                  "imageUrl": "https://res.cloudinary.com/.../product.jpg",
                  "stock": 50,
                  "rating": 4.7,
                  "ordersCount": 120,
                  "status": "displayed"
                }
              ]
            }
          },
          "500": {
            "description": "Server error",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      }
    },

    "/recommend/personalized": {
      "get": {
        "tags": ["Recommend"],
        "summary": "Get personalized product recommendations",
        "description": "Gợi ý sản phẩm dựa trên lịch sử mua hàng của user. Nếu chưa có lịch sử mua thì trả về fallback top-selling.",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "List of recommended products",
            "examples": {
              "application/json": [
                {
                  "_id": "69105000ad02ab999d92ae42",
                  "name": "Chocolate Cookie",
                  "price": 45000,
                  "discountPercent": 34,
                  "imageUrl": "https://res.cloudinary.com/.../cookie.jpg",
                  "stock": 50,
                  "rating": 4,
                  "ordersCount": 20,
                  "status": "displayed"
                }
              ]
            }
          },
          "401": {
            "description": "Unauthorized",
            "examples": { "application/json": { "error": "Unauthorized" } }
          },
          "500": {
            "description": "Server error",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      }
    },

    "/recommend/shops-discount": {
      "get": {
        "tags": ["Recommend"],
        "summary": "Get shops with most discounted products",
        "description": "Trả về danh sách shop có nhiều sản phẩm giảm giá nhất.",
        "responses": {
          "200": {
            "description": "List of shops with discount count",
            "examples": {
              "application/json": [
                {
                  "shop": {
                    "_id": "690fadc73ea71a56cb5be84e",
                    "name": "Tiệm gà Posu",
                    "phone": "0987654321",
                    "address": "123 Đường Hàn Thuyên",
                    "avatar": "https://res.cloudinary.com/.../avatar.jpg",
                    "cover": "https://res.cloudinary.com/.../cover.jpg"
                  },
                  "discountCount": 5
                }
              ]
            }
          },
          "500": {
            "description": "Server error",
            "examples": {
              "application/json": { "error": "Internal server error" }
            }
          }
        }
      }
    },
    "/loyalty/me": {
      "get": {
        "tags": ["Loyalty"],
        "summary": "Lấy danh sách điểm thân thiết của user hiện tại",
        "description": "Trả về tất cả bản ghi Loyalty thuộc về người dùng đăng nhập. Mỗi bản ghi liên kết với một shop.",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "Danh sách loyalty của user",
            "examples": {
              "application/json": [
                {
                  "_id": "6756001f2e9c2a4f77f1b001",
                  "user": "6731111aaa2222bbb3333ccc",
                  "shop": {
                    "_id": "6733f0d024f23c6f9c28a77d",
                    "name": "Trà Sữa Triet",
                    "email": "contact@trietshop.com"
                  },
                  "points": 120,
                  "createdAt": "2025-11-21T08:15:00.000Z",
                  "updatedAt": "2025-11-21T08:30:10.000Z"
                }
              ]
            }
          },
          "401": {
            "description": "Không có hoặc token không hợp lệ",
            "examples": { "application/json": { "error": "Unauthorized" } }
          }
        }
      }
    },
    "/loyalty": {
      "get": {
        "tags": ["Loyalty"],
        "summary": "Admin: Lấy tất cả bản ghi loyalty",
        "description": "Chỉ admin. Liệt kê toàn bộ điểm thân thiết của mọi người dùng và shop.",
        "security": [{ "Bearer": [] }],
        "responses": {
          "200": {
            "description": "Danh sách tất cả loyalty",
            "examples": {
              "application/json": [
                {
                  "_id": "6756001f2e9c2a4f77f1b001",
                  "user": {
                    "_id": "6731111aaa2222bbb3333ccc",
                    "name": "Triet",
                    "email": "triet@example.com"
                  },
                  "shop": {
                    "_id": "6733f0d024f23c6f9c28a77d",
                    "name": "Trà Sữa Triet",
                    "email": "contact@trietshop.com"
                  },
                  "points": 120
                },
                {
                  "_id": "6756001f2e9c2a4f77f1b002",
                  "user": {
                    "_id": "6732222aaa2222bbb3333ddd",
                    "name": "Minh",
                    "email": "minh@example.com"
                  },
                  "shop": {
                    "_id": "673400d024f23c6f9c28a88e",
                    "name": "Bánh Ngọt Triet",
                    "email": "sweet@trietcakes.com"
                  },
                  "points": 45
                }
              ]
            }
          },
          "403": {
            "description": "Không phải admin",
            "examples": { "application/json": { "error": "Forbidden" } }
          },
          "401": {
            "description": "Unauthorized",
            "examples": { "application/json": { "error": "Unauthorized" } }
          }
        }
      }
    },
    "/loyalty/{id}": {
      "put": {
        "tags": ["Loyalty"],
        "summary": "Admin: Cập nhật điểm loyalty",
        "description": "Chỉ admin. Cho phép chỉnh sửa số điểm hoặc các trường khác của bản ghi loyalty.",
        "security": [{ "Bearer": [] }],
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "type": "string",
            "example": "6756001f2e9c2a4f77f1b001"
          },
          {
            "in": "body",
            "name": "body",
            "required": true,
            "schema": {
              "type": "object",
              "properties": {
                "points": { "type": "integer", "example": 200 }
              }
            },
            "example": { "points": 200 }
          }
        ],
        "responses": {
          "200": {
            "description": "Đã cập nhật",
            "examples": {
              "application/json": {
                "_id": "6756001f2e9c2a4f77f1b001",
                "user": "6731111aaa2222bbb3333ccc",
                "shop": "6733f0d024f23c6f9c28a77d",
                "points": 200,
                "updatedAt": "2025-11-21T09:00:00.000Z"
              }
            }
          },
          "403": {
            "description": "Không phải admin",
            "examples": { "application/json": { "error": "Forbidden" } }
          },
          "404": {
            "description": "Không tìm thấy bản ghi",
            "examples": {
              "application/json": { "error": "Loyalty record not found" }
            }
          },
          "401": {
            "description": "Unauthorized",
            "examples": { "application/json": { "error": "Unauthorized" } }
          }
        }
      }
    }
  }
}
